<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Календарь смен 2/2 (3 человека)</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#121826; --muted:#8aa0b8; --text:#e9f0f7;
      --line:rgba(255,255,255,.08);
      --w1:#7aa2ff; --w2:#7dffb2; --w3:#ffb86b;
      --today:rgba(255,255,255,.10);
      --work:rgba(255,255,255,.12);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b0f14,#070a0f);color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .top{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px}
    .title{display:flex;flex-direction:column;gap:4px}
    h1{font-size:18px;margin:0}
    .sub{font-size:13px;color:var(--muted)}
    .card{background:rgba(18,24,38,.8);border:1px solid var(--line);border-radius:var(--radius);padding:12px;backdrop-filter: blur(8px);}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{
      border:1px solid var(--line);background:transparent;color:var(--text);
      padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:700;
      display:flex;gap:8px;align-items:center;
    }
    .btn:hover{border-color:rgba(255,255,255,.18)}
    .btn.active{outline:2px solid rgba(255,255,255,.18)}
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
    .nav{display:flex;gap:8px;align-items:center}
    .nav button{padding:10px 12px}
    .legend{display:flex;gap:10px;flex-wrap:wrap;font-size:12px;color:var(--muted)}
    .legend span{display:flex;gap:6px;align-items:center}

    .grid{display:grid;grid-template-columns: 1fr; gap:12px}
    @media(min-width:860px){ .grid{grid-template-columns: 320px 1fr; align-items:start;} }

    .month{
      display:grid;grid-template-columns: repeat(7, 1fr);
      gap:10px;
    }
    .dow{
      font-size:12px;color:var(--muted);text-align:center;padding:6px 0;
    }
    .day{
      border:1px solid var(--line);border-radius:14px;min-height:74px;
      padding:10px;position:relative;overflow:hidden;
      background:rgba(255,255,255,.03);
    }
    .day.muted{opacity:.45}
    .day.today{box-shadow:0 0 0 2px rgba(255,255,255,.12) inset;background:var(--today)}
    .num{font-weight:800;font-size:14px}
    .pair{margin-top:8px;font-size:12px;color:var(--muted);display:flex;gap:6px;flex-wrap:wrap}
    .pill{
      padding:2px 8px;border-radius:999px;border:1px solid var(--line);
      background:rgba(255,255,255,.04);font-weight:700
    }
    .workMark{
      position:absolute;inset:0;background:transparent;pointer-events:none;
    }
    .day.work .workMark{ background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,0)); }
    .stripe{
      position:absolute;left:-40px;top:-40px;width:120px;height:120px;transform:rotate(35deg);
      opacity:.9;filter: blur(0px);
    }
    .stripe.w1{background:linear-gradient(180deg,var(--w1),transparent)}
    .stripe.w2{background:linear-gradient(180deg,var(--w2),transparent)}
    .stripe.w3{background:linear-gradient(180deg,var(--w3),transparent)}

    .hint{font-size:13px;color:var(--muted);line-height:1.45}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
    .kpi .box{border:1px solid var(--line);border-radius:14px;padding:10px;background:rgba(255,255,255,.03)}
    .kpi .n{font-size:18px;font-weight:900}
    .kpi .t{font-size:12px;color:var(--muted)}
    .small{font-size:12px;color:var(--muted);margin-top:10px}
    a{color:#9cc5ff}
    input{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);
      background:rgba(0,0,0,.25);color:var(--text);font-weight:700;
    }
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="title">
        <h1>Календарь смен 2/2 — 3 человека</h1>
        <div class="sub">Кликни на сотрудника — подсветятся его рабочие дни. Цикл парами: (1+2) → (2+3) → (1+3) блоками по 2 дня.</div>
      </div>
      <div class="nav">
        <button class="btn" id="prev">← Месяц</button>
        <button class="btn" id="next">Месяц →</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="controls" id="people"></div>

        <div style="height:12px"></div>

        <label for="anchor">Якорная дата (начало блока “1+2” на 2 дня)</label>
        <input id="anchor" type="date" />

        <div class="small">Пример из твоего описания: если “1+2” работают 15–16, то якорь = 15-е. Дальше страница сама считает пары.</div>

        <div class="kpi" id="kpi"></div>

        <div style="height:12px"></div>
        <div class="legend">
          <span><i class="dot" style="background:var(--w1)"></i> Работник 1</span>
          <span><i class="dot" style="background:var(--w2)"></i> Работник 2</span>
          <span><i class="dot" style="background:var(--w3)"></i> Работник 3</span>
        </div>

        <div style="height:12px"></div>
        <div class="hint">
          Подсказка: можно включить сразу двух/трёх — тогда будет видно, кто из них работает в конкретные дни.
        </div>
      </div>

      <div class="card">
        <div class="top" style="margin:0 0 10px;justify-content:space-between">
          <div class="title">
            <div class="sub" id="monthTitle" style="font-size:14px"></div>
          </div>
        </div>

        <div class="month" id="cal">
          <!-- DOW -->
        </div>
      </div>
    </div>
  </div>

<script>
  // ====== НАСТРОЙКИ ======
  const PEOPLE = [
    { id: 1, name: "Работник 1", colorClass: "w1" },
    { id: 2, name: "Работник 2", colorClass: "w2" },
    { id: 3, name: "Работник 3", colorClass: "w3" },
  ];

  // по умолчанию: якорь = 15-е текущего месяца (можешь поменять в интерфейсе)
  function defaultAnchor() {
    const now = new Date();
    return new Date(now.getFullYear(), now.getMonth(), 15);
  }

  // ====== ЛОГИКА ЦИКЛА ======
  // Блоки по 2 дня:
  // 0 => 1+2
  // 1 => 2+3
  // 2 => 1+3
  const PAIRS = [
    [1,2],
    [2,3],
    [1,3],
  ];

  function daysBetween(a, b){
    // UTC чтобы не ловить сдвиги из-за DST/часовых поясов
    const utcA = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
    const utcB = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());
    return Math.floor((utcB - utcA) / 86400000);
  }

  function pairForDate(date, anchor){
    const diff = daysBetween(anchor, date);
    const block = Math.floor(diff / 2);
    const idx = ((block % 3) + 3) % 3; // на случай дат "до якоря"
    return PAIRS[idx];
  }

  function isWorking(personId, date, anchor){
    const pair = pairForDate(date, anchor);
    return pair.includes(personId);
  }

  // ====== UI ======
  const calEl = document.getElementById("cal");
  const peopleEl = document.getElementById("people");
  const monthTitleEl = document.getElementById("monthTitle");
  const kpiEl = document.getElementById("kpi");
  const anchorEl = document.getElementById("anchor");

  let shown = new Date(); // текущий месяц для отображения
  let selected = new Set([1]); // по умолчанию выбран 1-й

  function fmtMonthTitle(d){
    return d.toLocaleDateString("ru-RU", { year:"numeric", month:"long" })
      .replace(" г.", "");
  }

  function setAnchorInput(d){
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    anchorEl.value = `${yyyy}-${mm}-${dd}`;
  }

  function getAnchor(){
    const v = anchorEl.value;
    const [y,m,d] = v.split("-").map(Number);
    return new Date(y, m-1, d);
  }

  function renderPeople(){
    peopleEl.innerHTML = "";
    PEOPLE.forEach(p => {
      const btn = document.createElement("button");
      btn.className = "btn" + (selected.has(p.id) ? " active" : "");
      btn.innerHTML = `<span class="dot" style="background:var(--${p.colorClass})"></span>${p.name}`;
      btn.onclick = () => {
        if (selected.has(p.id)) selected.delete(p.id);
        else selected.add(p.id);
        if (selected.size === 0) selected.add(p.id); // не даём оставить пусто
        renderPeople();
        renderCalendar();
      };
      peopleEl.appendChild(btn);
    });
  }

  function renderKpi(monthDate, anchor){
    const y = monthDate.getFullYear();
    const m = monthDate.getMonth();
    const daysInMonth = new Date(y, m+1, 0).getDate();

    const counts = {1:0,2:0,3:0};
    for(let d=1; d<=daysInMonth; d++){
      const date = new Date(y,m,d);
      for(const pid of [1,2,3]){
        if (isWorking(pid, date, anchor)) counts[pid]++;
      }
    }

    kpiEl.innerHTML = "";
    PEOPLE.forEach(p => {
      const box = document.createElement("div");
      box.className = "box";
      box.innerHTML = `<div class="n">${counts[p.id]}</div><div class="t">${p.name}: рабочих дней в месяце</div>`;
      kpiEl.appendChild(box);
    });
  }

  function renderCalendar(){
    const anchor = getAnchor();
    const y = shown.getFullYear();
    const m = shown.getMonth();

    monthTitleEl.textContent = fmtMonthTitle(shown);

    calEl.innerHTML = "";
    const dows = ["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];
    dows.forEach(x=>{
      const el = document.createElement("div");
      el.className = "dow";
      el.textContent = x;
      calEl.appendChild(el);
    });

    const first = new Date(y, m, 1);
    const startDow = (first.getDay() + 6) % 7; // Пн=0...Вс=6
    const daysInMonth = new Date(y, m+1, 0).getDate();
    const daysInPrev = new Date(y, m, 0).getDate();

    // "хвост" прошлого месяца
    for(let i=0;i<startDow;i++){
      const d = daysInPrev - startDow + 1 + i;
      const date = new Date(y, m-1, d);
      calEl.appendChild(dayCell(date, true, anchor));
    }
    // текущий месяц
    for(let d=1; d<=daysInMonth; d++){
      const date = new Date(y, m, d);
      calEl.appendChild(dayCell(date, false, anchor));
    }
    // добиваем до полного ряда
    const totalCells = 7 + startDow + daysInMonth; // включая DOW
    const after = (Math.ceil(totalCells/7)*7) - totalCells;
    for(let i=1;i<=after;i++){
      const date = new Date(y, m+1, i);
      calEl.appendChild(dayCell(date, true, anchor));
    }

    renderKpi(shown, anchor);
  }

  function dayCell(date, muted, anchor){
    const el = document.createElement("div");
    el.className = "day" + (muted ? " muted" : "");
    const now = new Date();
    const isToday = date.getFullYear()===now.getFullYear() && date.getMonth()===now.getMonth() && date.getDate()===now.getDate();
    if (isToday) el.classList.add("today");

    // кто работает в этот день (пара)
    const pair = pairForDate(date, anchor);
    const pairText = pair.join("+");

    // подсветка выбранных
    const workingSelected = [...selected].filter(pid => isWorking(pid, date, anchor));
    if (workingSelected.length > 0) el.classList.add("work");

    const stripes = workingSelected.map(pid => {
      const p = PEOPLE.find(x=>x.id===pid);
      return `<div class="stripe ${p.colorClass}"></div>`;
    }).join("");

    el.innerHTML = `
      <div class="workMark"></div>
      ${stripes}
      <div class="num">${date.getDate()}</div>
      <div class="pair">
        <span class="pill">${pairText}</span>
      </div>
    `;
    return el;
  }

  document.getElementById("prev").onclick = () => {
    shown = new Date(shown.getFullYear(), shown.getMonth()-1, 1);
    renderCalendar();
  };
  document.getElementById("next").onclick = () => {
    shown = new Date(shown.getFullYear(), shown.getMonth()+1, 1);
    renderCalendar();
  };
  anchorEl.addEventListener("change", renderCalendar);

  // init
  setAnchorInput(defaultAnchor());
  renderPeople();
  renderCalendar();
</script>
</body>
</html>
