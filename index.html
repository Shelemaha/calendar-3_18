<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ì—Ä–∞—Ñ—ñ–∫ —á–µ—Ä–≥—É–≤–∞–Ω—å</title>
  <style>
    :root{
      --text:#e9f0f7;
      --muted:#9ab0c8;
      --line:rgba(255,255,255,.12);

      /* –Ø–°–ö–†–ê–í–Ü–®–Ü –∫–æ–ª—å–æ—Ä–∏ —ñ–Ω–∂–µ–Ω–µ—Ä—ñ–≤ */
      --c1:#2F7DFF; --c1f:rgba(47,125,255,.38);   /* —Å–∏–Ω—ñ–π —è—Å–∫—Ä–∞–≤—ñ—à–µ */
      --c2:#00E676; --c2f:rgba(0,230,118,.32);    /* –∑–µ–ª–µ–Ω–∏–π –Ω–µ–æ–Ω—á–∏–∫ */
      --c3:#FFEB3B; --c3f:rgba(255,193,7,.30);    /* —ñ–Ω–∂ 3: –ª–∏–º–æ–Ω–Ω–∏–π, –∑–∞–ª–∏–≤–∫–∞ ‚Äú–∑–æ–ª–æ—Ç–∞‚Äù */

      --radius:16px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1100px 700px at 20% 0%, rgba(47,125,255,.14), transparent 60%),
                  radial-gradient(900px 600px at 80% 20%, rgba(0,230,118,.12), transparent 55%),
                  radial-gradient(900px 600px at 80% 80%, rgba(255,193,7,.10), transparent 55%),
                  linear-gradient(180deg,#0b0f14,#070a0f);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }

    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .top{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:18px;margin:0}
    .sub{font-size:13px;color:var(--muted);line-height:1.35}

    .card{
      background: rgba(18,24,38,.86);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:12px;
      backdrop-filter: blur(10px);
    }

    .grid{display:grid;grid-template-columns: 1fr; gap:12px}
    @media(min-width:860px){ .grid{grid-template-columns: 380px 1fr; align-items:start;} }

    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{
      border:1px solid var(--line);
      background: rgba(0,0,0,.15);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      display:flex;gap:8px;align-items:center;
      user-select:none;
    }
    .btn:hover{border-color:rgba(255,255,255,.22)}
    .btn.active{outline:2px solid rgba(255,255,255,.18); border-color:rgba(255,255,255,.25)}
    .btn:disabled{opacity:.45; cursor:not-allowed}

    .dot{width:10px;height:10px;border-radius:999px;display:inline-block}

    .nav{display:flex;gap:8px;align-items:center}
    .nav button{padding:10px 12px}

    .month{display:grid;grid-template-columns: repeat(7, 1fr);gap:10px;}
    .dow{font-size:12px;color:var(--muted);text-align:center;padding:6px 0}

    .day{
      border:1px solid var(--line);
      border-radius:14px;
      min-height:86px;
      padding:10px;
      position:relative;
      background: rgba(255,255,255,.03);
      overflow:hidden;
    }
    .day.muted{opacity:.48}

    /* –°—å–æ–≥–æ–¥–Ω—ñ: —Ç—ñ–ª—å–∫–∏ —Ä–∞–º–∫–∞ + –∂–∏—Ä–Ω—ñ—à–µ —á–∏—Å–ª–æ */
    .day.today{
      border:2px solid rgba(255,255,255,.92);
      background: rgba(255,255,255,.06);
    }
    .day.today .num{
      font-weight:1000;
      font-size:16px;
    }

    .num{font-weight:900;font-size:14px}

    /* –ó–∞–ª–∏–≤–∫–∞ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —ñ–Ω–∂–µ–Ω–µ—Ä–∞ (–π–æ–≥–æ —Ä–æ–±–æ—á—ñ –¥–Ω—ñ) */
    .fill{
      position:absolute; inset:0;
      opacity:0;
      pointer-events:none;
    }
    .day.primaryWork .fill{opacity:1}

    /* –ü–æ–ª–æ—Å–∫–∞ –∑–ª—ñ–≤–∞ –¥–ª—è –Ω–∞–ø–∞—Ä–Ω–∏–∫–∞ (–∫–æ–ª–∏ –≤—ñ–Ω –ø—Ä–∞—Ü—é—î) */
    .mateStripe{
      position:absolute; left:0; top:0; bottom:0; width:6px;
      opacity:0;
      pointer-events:none;
    }
    .day.mateWork .mateStripe{opacity:1}

    /* –ö—Ä—É–∂–æ–∫ –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫–∞ 358/323 */
    .gBadge{
      position:absolute;
      left:10px;
      bottom:10px;
      width:34px;height:34px;
      border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      font-size:12px;font-weight:950;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.30);
      color: var(--text);
    }

    .infoBlock{display:grid;gap:10px;margin-top:12px}
    .infoCard{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background:rgba(255,255,255,.03);
    }
    .infoTitle{display:flex;gap:8px;align-items:center;font-weight:950}
    .infoRow{margin-top:6px;font-size:13px}

    .warn{
      display:inline-block;
      margin-left:6px;
      font-size:11px;
      font-weight:900;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      vertical-align:middle;
    }
    /* 2 –¥–Ω—ñ ‚Äî –±—ñ–ª–∏–º */
    .warn.soon{
      color:#0b0f14;
      background:#fff;
      border-color:#fff;
    }
    /* 1 –¥–µ–Ω—å ‚Äî —á–µ—Ä–≤–æ–Ω–∏–º */
    .warn.urgent{
      color:#fff;
      background: rgba(255,59,48,.95);
      border-color: rgba(255,59,48,.95);
    }
    .urgentText{
      margin-top:8px;
      font-size:12px;
      font-weight:900;
      color:#fff;
      background: rgba(255,59,48,.18);
      border: 1px solid rgba(255,59,48,.45);
      padding:8px 10px;
      border-radius:12px;
      line-height:1.25;
    }

    .sectionTitle{
      margin-top:12px;
      font-size:12px;
      color:var(--muted);
      font-weight:900;
      letter-spacing:.04em;
      text-transform:uppercase;
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>–ì—Ä–∞—Ñ—ñ–∫ —á–µ—Ä–≥—É–≤–∞–Ω—å</h1>
      <div class="sub">–ì—Ä–∞—Ñ—ñ–∫: 4/2</div>
    </div>
    <div class="nav">
      <button class="btn" id="prev">‚Üê –ú—ñ—Å—è—Ü—å</button>
      <button class="btn" id="next">–ú—ñ—Å—è—Ü—å ‚Üí</button>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="sectionTitle">‚ö° –Ü–Ω–∂–µ–Ω–µ—Ä–∏</div>
      <div class="controls" id="primaryBtns"></div>

      <div style="height:10px"></div>

      <div class="controls">
        <button class="btn" id="mateToggle" disabled>ü¶∏‚Äç‚ôÇÔ∏è –ù–∞–ø–∞—Ä–Ω–∏–∫</button>
      </div>
      <div class="controls" id="mateBtns" style="display:none;margin-top:10px"></div>

      <div class="sectionTitle">üìå –ì—Ä–∞—Ñ—ñ–∫–∏</div>
      <div class="controls" id="graphBtns"></div>

      <div class="infoBlock" id="info"></div>
    </div>

    <div class="card">
      <div class="sub" id="monthTitle" style="font-size:14px;margin:0 0 10px"></div>
      <div class="month" id="cal"></div>
    </div>
  </div>
</div>

<script>
  // ===== –Ü–Ω–∂–µ–Ω–µ—Ä–∏ =====
  const PEOPLE = [
    { id: 1, name: "–Ü–Ω–∂–µ–Ω–µ—Ä 1", color: "var(--c1)", fill: "var(--c1f)" },
    { id: 2, name: "–Ü–Ω–∂–µ–Ω–µ—Ä 2", color: "var(--c2)", fill: "var(--c2f)" },
    { id: 3, name: "–Ü–Ω–∂–µ–Ω–µ—Ä 3", color: "var(--c3)", fill: "var(--c3f)" },
  ];

  // ===== –ì—Ä–∞—Ñ—ñ–∫–∏ =====
  const GRAPHS = ["358","323"];

  // –Ø–∫—ñ—Ä: 15‚Äì16.01.2026 —è–∫ —É –ø—Ä–∏–∫–ª–∞–¥—ñ
  const ANCHOR = new Date(2026, 0, 15);

  // –ü–æ—á–∞—Ç–∫–æ–≤—ñ –≥—Ä–∞—Ñ—ñ–∫–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç—ñ —è–∫–æ—Ä—è
  const INITIAL_ASSIGNMENT = { 1: "358", 2: "358", 3: "323" };

  // –í –∫—ñ–Ω—Ü—ñ –∫–æ–∂–Ω–æ–≥–æ 2-–¥–µ–Ω–Ω–æ–≥–æ –±–ª–æ–∫—É –ø–µ—Ä–µ–º–∏–∫–∞—î—Ç—å—Å—è –æ–¥–∏–Ω —ñ–Ω–∂–µ–Ω–µ—Ä: 2 -> 3 -> 1 -> –ø–æ–≤—Ç–æ—Ä
  const SWITCH_ORDER = [2, 3, 1];

  // ===== –î–∞—Ç–∏/–ª–æ–≥—ñ–∫–∞ =====
  function daysBetween(a, b){
    const utcA = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
    const utcB = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());
    return Math.floor((utcB - utcA) / 86400000);
  }
  function addDays(d, n){ return new Date(d.getFullYear(), d.getMonth(), d.getDate() + n); }
  function blockIndexForDate(date){
    const diff = daysBetween(ANCHOR, date);
    return Math.floor(diff / 2);
  }
  function startOfBlock(blockIndex){ return addDays(ANCHOR, blockIndex * 2); }

  // –Ø–∫–∏–π –≥—Ä–∞—Ñ—ñ–∫ "–∞–∫—Ç–∏–≤–Ω–∏–π" –≤ —Ü–µ–π 2-–¥–µ–Ω–Ω–∏–π –±–ª–æ–∫ (–ø—Ä–∞—Ü—é—î)
  function workingGraphForBlock(blockIndex){ return (blockIndex % 2 === 0) ? "358" : "323"; }
  function toggleGraph(g){ return g === "358" ? "323" : "358"; }

  function assignmentAtBlock(targetBlock){
    let a = { ...INITIAL_ASSIGNMENT };
    if (targetBlock === 0) return a;

    if (targetBlock > 0){
      for (let b = 0; b < targetBlock; b++){
        const sw = SWITCH_ORDER[((b % 3) + 3) % 3];
        a[sw] = toggleGraph(a[sw]);
      }
      return a;
    }

    for (let b = -1; b >= targetBlock; b--){
      const sw = SWITCH_ORDER[(((b % 3) + 3) % 3)];
      a[sw] = toggleGraph(a[sw]);
    }
    return a;
  }

  function graphOnDate(personId, date){
    const bi = blockIndexForDate(date);
    const a = assignmentAtBlock(bi);
    return a[personId];
  }

  function isWorkingOnDate(personId, date){
    const bi = blockIndexForDate(date);
    return graphOnDate(personId, date) === workingGraphForBlock(bi);
  }

  // –ù–∞—Å—Ç—É–ø–Ω–µ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è ‚Äî —Å—Ç—Ä–æ–≥–æ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É (0 –¥–Ω—ñ–≤ –Ω–µ –±—É–¥–µ)
  function nextSwitchDate(personId, fromDate){
    const currentBlock = blockIndexForDate(fromDate);
    for (let b = currentBlock; b < currentBlock + 2000; b++){
      const sw = SWITCH_ORDER[(((b % 3) + 3) % 3)];
      if (sw === personId){
        const candidate = startOfBlock(b + 1);
        if (daysBetween(fromDate, candidate) > 0) return candidate; // —Å—Ç—Ä–æ–≥–æ > —Å—å–æ–≥–æ–¥–Ω—ñ
      }
    }
    return null;
  }

  function fmtDateUA(d){
    return d.toLocaleDateString("uk-UA", { day:"2-digit", month:"long", year:"numeric" });
  }
  function fmtMonthUA(d){
    return d.toLocaleDateString("uk-UA", { month:"long", year:"numeric" });
  }

  // ===== UI —Å—Ç–∞–Ω =====
  let shown = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
  let primary = null;
  let mate = null;
  let mateMode = false;

  const selectedGraphs = new Set(); // "358", "323"

  const calEl = document.getElementById("cal");
  const monthTitleEl = document.getElementById("monthTitle");
  const primaryBtnsEl = document.getElementById("primaryBtns");
  const mateToggleEl = document.getElementById("mateToggle");
  const mateBtnsEl = document.getElementById("mateBtns");
  const infoEl = document.getElementById("info");
  const graphBtnsEl = document.getElementById("graphBtns");

  function personById(id){ return PEOPLE.find(p => p.id === id); }

  function setPrimary(id){
    if (primary === id){
      primary = null;
      mate = null;
      mateMode = false;
      mateToggleEl.classList.remove("active");
      mateBtnsEl.style.display = "none";
    } else {
      primary = id;
      if (mate === primary) mate = null;
    }
    renderAll();
  }

  function toggleMateMode(){
    if (!primary) return;
    mateMode = !mateMode;
    if (!mateMode) mate = null;
    renderAll();
  }

  function setMate(id){
    if (!primary) return;
    if (id === primary) return;
    mate = (mate === id) ? null : id;
    renderAll();
  }

  function toggleGraphPick(g){
    if (selectedGraphs.has(g)) selectedGraphs.delete(g);
    else selectedGraphs.add(g);
    renderAll();
  }

  // ===== Render –∫–Ω–æ–ø–æ–∫ =====
  function renderPrimaryButtons(){
    primaryBtnsEl.innerHTML = "";
    PEOPLE.forEach(p => {
      const btn = document.createElement("button");
      btn.className = "btn" + (primary === p.id ? " active" : "");
      btn.innerHTML = `<span class="dot" style="background:${p.color}"></span>${p.name}`;
      btn.onclick = () => setPrimary(p.id);
      primaryBtnsEl.appendChild(btn);
    });
  }

  function renderMateUI(){
    mateToggleEl.disabled = !primary;
    mateToggleEl.classList.toggle("active", !!primary && mateMode);

    if (!primary || !mateMode){
      mateBtnsEl.style.display = "none";
      mateBtnsEl.innerHTML = "";
      return;
    }

    mateBtnsEl.style.display = "flex";
    mateBtnsEl.style.gap = "10px";
    mateBtnsEl.style.flexWrap = "wrap";

    mateBtnsEl.innerHTML = "";
    PEOPLE.filter(p => p.id !== primary).forEach(p => {
      const btn = document.createElement("button");
      btn.className = "btn" + (mate === p.id ? " active" : "");
      btn.innerHTML = `<span class="dot" style="background:${p.color}"></span>${p.name}`;
      btn.onclick = () => setMate(p.id);
      mateBtnsEl.appendChild(btn);
    });
  }

  function renderGraphButtons(){
    graphBtnsEl.innerHTML = "";
    GRAPHS.forEach(g => {
      const btn = document.createElement("button");
      btn.className = "btn" + (selectedGraphs.has(g) ? " active" : "");
      btn.textContent = g;
      btn.onclick = () => toggleGraphPick(g);
      graphBtnsEl.appendChild(btn);
    });
  }

  // ===== –Ü–Ω—Ñ–æ (—Ç—ñ–ª—å–∫–∏ –ø—Ä–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —ñ–Ω–∂–µ–Ω–µ—Ä–∞) =====
  function renderInfo(){
    infoEl.innerHTML = "";
    const today = new Date();

    if (!primary) return;

    const p = personById(primary);
    const works = isWorkingOnDate(primary, today);
    const gToday = graphOnDate(primary, today);

    const ns = nextSwitchDate(primary, today);
    const left = ns ? daysBetween(today, ns) : null;

    let warnClass = "warn";
    if (left === 2) warnClass = "warn soon";
    if (left === 1) warnClass = "warn urgent";

    const targetGraph = toggleGraph(gToday);

    infoEl.insertAdjacentHTML("beforeend", `
      <div class="infoCard">
        <div class="infoTitle"><span class="dot" style="background:${p.color}"></span>${p.name}</div>
        <div class="infoRow"><b>–°—å–æ–≥–æ–¥–Ω—ñ:</b> ${works ? "–ø—Ä–∞—Ü—é—î" : "–≤–∏—Ö—ñ–¥–Ω–∏–π"} <span class="${warnClass}">${gToday}</span></div>
        <div class="infoRow"><b>–ü–µ—Ä–µ—Ö—ñ–¥:</b> ${ns ? fmtDateUA(ns) : "‚Äî"} <span class="${warnClass}">${left !== null ? `${left} –¥–Ω.` : ""}</span></div>
        ${left === 1 ? `
          <div class="urgentText">
            –ù–µ –∑–∞–±—É–¥—å –Ω–∞–ø–∏—Å–∞—Ç–∏ –°–ó –Ω–∞ –∑–º—ñ–Ω—É –≥—Ä–∞—Ñ—ñ–∫–∞ –Ω–∞ ${targetGraph}: –∑–∞–≤—Ç—Ä–∞ –ø–µ—Ä–µ—Ö—ñ–¥ –≥—Ä–∞—Ñ—ñ–∫–∞.
          </div>
        ` : ``}
      </div>
    `);
  }

  // ===== –ì—Ä–∞—Ñ—ñ–∫ —É –∫—Ä—É–∂–∫—É (–Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —ñ–Ω–∂–µ–Ω–µ—Ä–∞) =====
  function graphBadgeTextForDay(date){
    if (selectedGraphs.size === 0) return null;
    const bi = blockIndexForDate(date);
    const active = workingGraphForBlock(bi);
    if (selectedGraphs.has(active)) return active;
    return null;
  }

  // ===== –Ø—á–µ–π–∫–∞ =====
  function dayCell(date, muted){
    const el = document.createElement("div");
    el.className = "day" + (muted ? " muted" : "");

    const now = new Date();
    const isToday = date.getFullYear()===now.getFullYear() && date.getMonth()===now.getMonth() && date.getDate()===now.getDate();
    if (isToday) el.classList.add("today");

    let fillBg = "transparent";
    if (primary && isWorkingOnDate(primary, date)){
      fillBg = personById(primary).fill;
      el.classList.add("primaryWork");
    }

    let mateStripeBg = "transparent";
    if (mateMode && mate && isWorkingOnDate(mate, date)){
      mateStripeBg = personById(mate).color;
      el.classList.add("mateWork");
    }

    const gText = graphBadgeTextForDay(date);

    el.innerHTML = `
      <div class="fill" style="background:${fillBg}"></div>
      <div class="mateStripe" style="background:${mateStripeBg}"></div>
      <div class="num">${date.getDate()}</div>
      ${gText ? `<div class="gBadge">${gText}</div>` : ``}
    `;
    return el;
  }

  // ===== Calendar render =====
  function renderCalendar(){
    monthTitleEl.textContent = `–ú—ñ—Å—è—Ü—å: ${fmtMonthUA(shown)}`;

    calEl.innerHTML = "";
    const dows = ["–ü–Ω","–í—Ç","–°—Ä","–ß—Ç","–ü—Ç","–°–±","–ù–¥"];
    dows.forEach(x=>{
      const el = document.createElement("div");
      el.className = "dow";
      el.textContent = x;
      calEl.appendChild(el);
    });

    const y = shown.getFullYear();
    const m = shown.getMonth();
    const first = new Date(y, m, 1);
    const startDow = (first.getDay() + 6) % 7;
    const daysInMonth = new Date(y, m+1, 0).getDate();
    const daysInPrev = new Date(y, m, 0).getDate();

    for(let i=0;i<startDow;i++){
      const d = daysInPrev - startDow + 1 + i;
      calEl.appendChild(dayCell(new Date(y, m-1, d), true));
    }
    for(let d=1; d<=daysInMonth; d++){
      calEl.appendChild(dayCell(new Date(y, m, d), false));
    }
    const totalCells = 7 + startDow + daysInMonth;
    const after = (Math.ceil(totalCells/7)*7) - totalCells;
    for(let i=1;i<=after;i++){
      calEl.appendChild(dayCell(new Date(y, m+1, i), true));
    }
  }

  document.getElementById("prev").onclick = () => {
    shown = new Date(shown.getFullYear(), shown.getMonth()-1, 1);
    renderAll();
  };
  document.getElementById("next").onclick = () => {
    shown = new Date(shown.getFullYear(), shown.getMonth()+1, 1);
    renderAll();
  };

  mateToggleEl.onclick = toggleMateMode;

  function renderAll(){
    renderPrimaryButtons();
    renderMateUI();
    renderGraphButtons();
    renderInfo();
    renderCalendar();
  }

  renderAll();
</script>
</body>
</html>
